<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marquee Control</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.1.0/paho-mqtt.min.js"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --success-color: #059669;
            --warning-color: #d97706;
            --error-color: #dc2626;
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-color: #1f2937;
            --border-color: #e5e7eb;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        [data-theme="dark"] {
            --bg-color: #1f2937;
            --card-bg: #374151;
            --text-color: #f9fafb;
            --border-color: #4b5563;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.3), 0 1px 2px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .header {
            background: var(--card-bg);
            padding: 1rem;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .right-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .refresh-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .refresh-control select {
            padding: 0.25rem 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 0.875rem;
        }

        .refresh-icon {
            cursor: pointer;
            color: var(--primary-color);
            transition: color 0.2s;
        }

        .refresh-icon:hover {
            color: #1d4ed8;
        }

        .refresh-icon:active {
            transform: rotate(180deg);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--error-color);
        }

        .status-dot.connected {
            background: var(--success-color);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .display-section {
            background: var(--card-bg);
            border-radius: 0.5rem;
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .canvas-container {
            padding: 1rem;
            display: flex;
            justify-content: center;
            background: #000;
        }

        #matrix_canvas {
            border-radius: 0.25rem;
            max-width: 100%;
            height: auto;
        }

        .tabs {
            display: flex;
            background: var(--card-bg);
            border-bottom: 1px solid var(--border-color);
        }

        .tab-button {
            flex: 1;
            padding: 1rem;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--secondary-color);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-button:hover {
            background: var(--bg-color);
        }

        .tab-content {
            padding: 1.5rem;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }

        .card {
            background: var(--card-bg);
            border-radius: 0.5rem;
            box-shadow: var(--shadow);
            padding: 1.5rem;
            border: 1px solid var(--border-color);
        }

        .card h3 {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        .form-row {
            display: flex;
            gap: 0.5rem;
        }

        .form-row .form-group {
            flex: 1;
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            font-size: 1rem;
            background: var(--card-bg);
            color: var(--text-color);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.375rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            min-height: 44px;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background: #475569;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #047857;
        }

        .btn-danger {
            background: var(--error-color);
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .btn-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
        }

        .log-section {
            background: var(--card-bg);
            border-radius: 0.5rem;
            box-shadow: var(--shadow);
            margin-top: 1.5rem;
        }

        .log-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .log-content {
            max-height: 200px;
            overflow-y: auto;
            padding: 1rem;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.875rem;
            background: #f8fafc;
            color: var(--text-color);
        }

        [data-theme="dark"] .log-content {
            background: #000000;
            color: #ffffff;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: 0.5rem;
            box-shadow: var(--shadow-lg);
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--secondary-color);
            padding: 0.25rem;
            border-radius: 0.25rem;
        }

        .close-btn:hover {
            background: var(--bg-color);
        }

        .range-slider {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .range-slider input {
            flex: 1;
        }

        .range-value {
            min-width: 3rem;
            text-align: center;
            font-weight: 600;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: 0.3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }

        .toggle-slider:hover {
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }

        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }

            .header {
                padding: 0.75rem;
            }

            .header h1 {
                font-size: 1.25rem;
            }

            .tab-content {
                padding: 1rem;
            }

            .card {
                padding: 1rem;
            }

            .btn-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                flex-direction: column;
            }

            .modal-content {
                width: 95%;
                margin: 1rem;
            }
        }

        @media (max-width: 480px) {
            .tabs {
                flex-direction: column;
            }

            .tab-button {
                justify-content: flex-start;
            }

            .log-header {
                flex-direction: column;
                gap: 0.5rem;
                align-items: stretch;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-tv"></i> Marquee Control</h1>
        <div class="right-controls">
            <i class="fas fa-sync refresh-icon" id="manual-refresh" title="Manual Refresh"></i>
            <div class="refresh-control">
                <select id="refresh-interval">
                    <option value="0">Off</option>
                    <option value="5">5s</option>
                    <option value="10">10s</option>
                    <option value="30" selected>30s</option>
                    <option value="60">60s</option>
                </select>
            </div>
            <div class="status">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">Connecting...</span>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="display-section">
            <div class="canvas-container">
                <canvas id="matrix_canvas" width="896" height="48"></canvas>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-button active" data-tab="templates">
                <i class="fas fa-layer-group"></i>
                <span>Templates</span>
            </button>
            <button class="tab-button" data-tab="display">
                <i class="fas fa-display"></i>
                <span>Display</span>
            </button>
            <button class="tab-button" data-tab="text">
                <i class="fas fa-font"></i>
                <span>Text</span>
            </button>
            <button class="tab-button" data-tab="games">
                <i class="fas fa-trophy"></i>
                <span>Games</span>
            </button>
            <button class="tab-button" data-tab="advanced">
                <i class="fas fa-cogs"></i>
                <span>Advanced</span>
            </button>
        </div>

        <div class="tab-content">
            <!-- Templates Tab -->
            <div class="tab-pane active" id="templates">
                <div class="card-grid">
                    <div class="card">
                        <h3><i class="fas fa-clock"></i> Set Template</h3>
                        <div class="form-group">
                            <label for="template-select">Template</label>
                            <select id="template-select">
                                <option value="clock">Clock</option>
                                <option value="base">Base</option>
                                <option value="gmonster">Green Monster</option>
                                <option value="tick">Tick</option>
                                <option value="timer">Timer</option>
                                <option value="weather">Weather</option>
                                <option value="xmas">Christmas</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="sendTemplate(document.getElementById('template-select').value)">
                            <i class="fas fa-play"></i> Apply Template
                        </button>
                    </div>

                    <div class="card">
                        <h3><i class="fas fa-magic"></i> Auto Template</h3>
                        <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                            <label for="auto-arg" style="margin-bottom: 0; font-size: 1rem;">Auto Argument</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="auto-arg">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Display Tab -->
            <div class="tab-pane" id="display">
                <div class="card-grid">
                    <div class="card">
                        <h3><i class="fas fa-sun"></i> Brightness</h3>
                        <div class="range-slider">
                            <input type="range" id="brightness-slider" min="0" max="100" value="5" oninput="updateBrightnessValue(this.value)">
                            <span class="range-value" id="brightness-value">5</span>
                        </div>
                        <button class="btn btn-primary" onclick="sendBright(document.getElementById('brightness-slider').value)">
                            <i class="fas fa-adjust"></i> Set Brightness
                        </button>
                    </div>

                    <div class="card">
                        <h3><i class="fas fa-eraser"></i> Display Control</h3>
                        <div class="btn-grid">
                            <button class="btn btn-success" onclick="sendClear()">
                                <i class="fas fa-trash"></i> Clear
                            </button>
                            <button class="btn btn-warning" onclick="sendReset()">
                                <i class="fas fa-undo"></i> Reset
                            </button>
                            <button class="btn btn-primary" onclick="getPixels()">
                                <i class="fas fa-sync"></i> Refresh
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <h3><i class="fas fa-cog"></i> System</h3>
                        <div class="form-group">
                            <label for="pixel-scale">Pixel Scale</label>
                            <div class="range-slider">
                                <input type="range" id="pixel-scale" min="1" max="10" value="2" oninput="updatePixelScaleValue(this.value)">
                                <span class="range-value" id="pixel-scale-value">2</span>
                            </div>
                        </div>
                        <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                            <label for="dark-mode" style="margin-bottom: 0; font-size: 1rem;">Dark Mode</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="dark-mode">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="btn-grid">
                            <button class="btn btn-warning" onclick="reconnect()">
                                <i class="fas fa-wifi"></i> Reconnect
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Text Tab -->
            <div class="tab-pane" id="text">
                <div class="card-grid">
                    <div class="card">
                        <h3><i class="fas fa-i-cursor"></i> Send Text</h3>
                        <div class="form-group">
                            <label for="text-message">Message</label>
                            <input type="text" id="text-message" placeholder="Enter text to display">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="text-size">Size</label>
                                <input type="number" id="text-size" value="16" min="8" max="48">
                            </div>
                            <div class="form-group">
                                <label for="text-x">X Position</label>
                                <input type="number" id="text-x" value="0">
                            </div>
                            <div class="form-group">
                                <label for="text-y">Y Position</label>
                                <input type="number" id="text-y" value="0">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="sendText(document.getElementById('text-message').value, document.getElementById('text-size').value, document.getElementById('text-x').value, document.getElementById('text-y').value)">
                            <i class="fas fa-paper-plane"></i> Send Text
                        </button>
                    </div>

                    <div class="card">
                        <h3><i class="fas fa-align-left"></i> Text Line</h3>
                        <div class="form-group">
                            <label for="line-message">Message</label>
                            <input type="text" id="line-message" placeholder="Enter text for line">
                        </div>
                        <div class="form-group">
                            <label for="line-number">Line Number</label>
                            <input type="number" id="line-number" value="1" min="1" max="8">
                        </div>
                        <button class="btn btn-primary" onclick="sendTextLine(document.getElementById('line-message').value, document.getElementById('line-number').value)">
                            <i class="fas fa-paper-plane"></i> Send to Line
                        </button>
                    </div>

                    <div class="card">
                        <h3><i class="fas fa-palette"></i> Colors</h3>
                        <div class="form-group">
                            <label>Background Color</label>
                            <div class="form-row">
                                <div class="form-group">
                                    <input type="number" id="bg-r" placeholder="R" min="0" max="255" value="0">
                                </div>
                                <div class="form-group">
                                    <input type="number" id="bg-g" placeholder="G" min="0" max="255" value="0">
                                </div>
                                <div class="form-group">
                                    <input type="number" id="bg-b" placeholder="B" min="0" max="255" value="0">
                                </div>
                                <div class="form-group" style="display: flex; align-items: center;">
                                    <input type="color" id="bg-color-picker" value="#000000" style="width: 100%; height: 100%; border: 1px solid var(--border-color); border-radius: 0.375rem; cursor: pointer; padding: 0;">
                                </div>
                            </div>
                            <button class="btn btn-secondary" onclick="sendBgColor(document.getElementById('bg-r').value, document.getElementById('bg-g').value, document.getElementById('bg-b').value)">
                                <i class="fas fa-fill"></i> Set Background
                            </button>
                        </div>

                        <div class="form-group">
                            <label>Foreground Color</label>
                            <div class="form-row">
                                <div class="form-group">
                                    <input type="number" id="fg-r" placeholder="R" min="0" max="255" value="255">
                                </div>
                                <div class="form-group">
                                    <input type="number" id="fg-g" placeholder="G" min="0" max="255" value="255">
                                </div>
                                <div class="form-group">
                                    <input type="number" id="fg-b" placeholder="B" min="0" max="255" value="255">
                                </div>
                                <div class="form-group" style="display: flex; align-items: center;">
                                    <input type="color" id="fg-color-picker" value="#ffffff" style="width: 100%; height: 100%; border: 1px solid var(--border-color); border-radius: 0.375rem; cursor: pointer; padding: 0;">
                                </div>
                            </div>
                            <button class="btn btn-secondary" onclick="sendFgColor(document.getElementById('fg-r').value, document.getElementById('fg-g').value, document.getElementById('fg-b').value)">
                                <i class="fas fa-font"></i> Set Foreground
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Games Tab -->
            <div class="tab-pane" id="games">
                <div class="card-grid">
                    <div class="card">
                        <h3><i class="fas fa-baseball-ball"></i> MLB Game</h3>
                        <div class="form-group">
                            <label for="mlb-game-pk">Game PK</label>
                            <input type="text" id="mlb-game-pk" placeholder="Enter MLB game ID">
                        </div>
                        <button class="btn btn-primary" onclick="sendMlbGame(document.getElementById('mlb-game-pk').value)">
                            <i class="fas fa-play"></i> Send MLB Game
                        </button>
                    </div>

                    <div class="card">
                        <h3><i class="fas fa-hockey-puck"></i> NHL Game</h3>
                        <div class="form-group">
                            <label for="nhl-game-pk">Game PK</label>
                            <input type="text" id="nhl-game-pk" placeholder="Enter NHL game ID">
                        </div>
                        <button class="btn btn-primary" onclick="sendNhlGame(document.getElementById('nhl-game-pk').value)">
                            <i class="fas fa-play"></i> Send NHL Game
                        </button>
                    </div>

                    <div class="card">
                        <h3><i class="fas fa-football-ball"></i> NFL Game</h3>
                        <div class="form-group">
                            <label for="nfl-game-pk">Game PK</label>
                            <input type="text" id="nfl-game-pk" placeholder="Enter NFL game ID">
                        </div>
                        <button class="btn btn-primary" onclick="sendNflGame(document.getElementById('nfl-game-pk').value)">
                            <i class="fas fa-play"></i> Send NFL Game
                        </button>
                    </div>

                    <div class="card">
                        <h3><i class="fas fa-vote-yea"></i> Election</h3>
                        <button class="btn btn-primary" onclick="sendElection()">
                            <i class="fas fa-play"></i> Send Election Data
                        </button>
                    </div>
                </div>
            </div>

            <!-- Advanced Tab -->
            <div class="tab-pane" id="advanced">
                <div class="card-grid">
                    <div class="card">
                        <h3><i class="fas fa-comment"></i> Send Box Message</h3>
                        <div class="form-group">
                            <label for="box-message">Message</label>
                            <input type="text" id="box-message" placeholder="Box message">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="box-type">Box Type</label>
                                <select id="box-type">
                                    <option value="team">Team</option>
                                    <option value="inning">Inning</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="box-side">Side</label>
                                <select id="box-side">
                                    <option value="away">Away</option>
                                    <option value="home">Home</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="box-inning">Inning</label>
                                <input type="number" id="box-inning">
                            </div>
                            <div class="form-group">
                                <label for="box-team">Team</label>
                                <input type="text" id="box-team">
                            </div>
                            <div class="form-group">
                                <label for="box-game">Game</label>
                                <input type="text" id="box-game">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="sendBox(document.getElementById('box-message').value, document.getElementById('box-type').value, document.getElementById('box-side').value, document.getElementById('box-inning').value, document.getElementById('box-team').value, document.getElementById('box-game').value)">
                            <i class="fas fa-paper-plane"></i> Send Box
                        </button>
                    </div>

                    <div class="card">
                        <h3><i class="fas fa-gamepad"></i> Game Updates</h3>
                        <div class="form-group">
                            <label for="batter-num">Batter Number</label>
                            <input type="number" id="batter-num">
                        </div>
                        <button class="btn btn-secondary" onclick="updateBatter(document.getElementById('batter-num').value)">
                            <i class="fas fa-user"></i> Update Batter
                        </button>

                        <div class="form-group">
                            <label for="base-select">Base</label>
                            <select id="base-select">
                                <option value="first">First</option>
                                <option value="second">Second</option>
                                <option value="third">Third</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="base-occupied"> Occupied
                            </label>
                        </div>
                        <button class="btn btn-secondary" onclick="updateBase(document.getElementById('base-select').value, document.getElementById('base-occupied').checked)">
                            <i class="fas fa-square"></i> Update Base
                        </button>

                        <div class="form-group">
                            <label for="game-status">Game Status</label>
                            <input type="text" id="game-status">
                        </div>
                        <button class="btn btn-secondary" onclick="updateGame(document.getElementById('game-status').value)">
                            <i class="fas fa-info"></i> Update Game
                        </button>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="count-type">Count Type</label>
                                <select id="count-type">
                                    <option value="balls">Balls</option>
                                    <option value="strikes">Strikes</option>
                                    <option value="outs">Outs</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="count-num">Number</label>
                                <input type="number" id="count-num" value="0">
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="updateCount(document.getElementById('count-type').value, document.getElementById('count-num').value)">
                            <i class="fas fa-hashtag"></i> Update Count
                        </button>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="inning-num">Inning</label>
                                <input type="number" id="inning-num" value="1">
                            </div>
                            <div class="form-group">
                                <label for="inning-status">Status</label>
                                <input type="text" id="inning-status">
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="updateInning(document.getElementById('inning-num').value, document.getElementById('inning-status').value)">
                            <i class="fas fa-clock"></i> Update Inning
                        </button>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="disable-win"> Disable Win Display
                            </label>
                        </div>
                        <button class="btn btn-warning" onclick="disableWin(document.getElementById('disable-win').checked)">
                            <i class="fas fa-ban"></i> Toggle Win Disable
                        </button>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="disable-close"> Disable Close Display
                            </label>
                        </div>
                        <button class="btn btn-warning" onclick="disableClose(document.getElementById('disable-close').checked)">
                            <i class="fas fa-ban"></i> Toggle Close Disable
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="log-section">
            <div class="log-header">
                <h3><i class="fas fa-terminal"></i> Console Log</h3>
                <button class="btn btn-secondary" onclick="clearLog()">
                    <i class="fas fa-trash"></i> Clear
                </button>
            </div>
            <div class="log-content" id="logContent">
                <div class="log-entry">Initializing Marquee Control...</div>
            </div>
        </div>
    </div>

    <!-- Import MQTT Handler -->
    <script type="module">
        import {
            sendTemplate, sendClear, sendBright, sendText, getPixels, reconnect, processPixels,
            sendAutoTemplate, sendBox, sendBgColor, sendFgColor, sendReset, sendTextLine,
            updateBatter, updateBase, updateGame, updateCount, updateInning, disableWin, disableClose,
            sendMlbGame, sendNhlGame, sendNflGame, sendElection
        } from "./mqttHandler.mjs";

        // Make functions globally available
        window.sendTemplate = sendTemplate;
        window.sendClear = sendClear;
        window.sendBright = sendBright;
        window.sendText = sendText;
        window.getPixels = getPixels;
        window.reconnect = reconnect;
        window.processPixels = processPixels;
        window.sendAutoTemplate = sendAutoTemplate;
        window.sendBox = sendBox;
        window.sendBgColor = sendBgColor;
        window.sendFgColor = sendFgColor;
        window.sendReset = sendReset;
        window.sendTextLine = sendTextLine;
        window.updateBatter = updateBatter;
        window.updateBase = updateBase;
        window.updateGame = updateGame;
        window.updateCount = updateCount;
        window.updateInning = updateInning;
        window.disableWin = disableWin;
        window.disableClose = disableClose;
        window.sendMlbGame = sendMlbGame;
        window.sendNhlGame = sendNhlGame;
        window.sendNflGame = sendNflGame;
        window.sendElection = sendElection;
    </script>

    <script>
        // Tab switching
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.dataset.tab;

                // Update tab buttons
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                // Update tab content
                document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
                document.getElementById(tabName).classList.add('active');
            });
        });

        // Canvas responsive sizing
        function resizeCanvas() {
            const canvas = document.getElementById('matrix_canvas');
            const container = document.querySelector('.canvas-container');

            if (window.innerWidth < 768) {
                canvas.width = 448;
                canvas.height = 96;
            } else {
                canvas.width = 896;
                canvas.height = 48;
            }
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Brightness slider update
        function updateBrightnessValue(value) {
            document.getElementById('brightness-value').textContent = value;
        }

        // Pixel scale slider update
        function updatePixelScaleValue(value) {
            document.getElementById('pixel-scale-value').textContent = value;
            localStorage.setItem('pixel-scale', value);
            // Refresh canvas to apply new scale
            if (window.pixels) {
                processPixels(JSON.stringify(window.pixels));
            }
        }

        // Logging system
        const logContent = document.getElementById('logContent');
        const originalLog = console.log;
        console.log = function(...args) {
            const message = args.join(' ');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logContent.appendChild(entry);
            logContent.scrollTop = logContent.scrollHeight;
            originalLog.apply(console, args);
        };

        function clearLog() {
            logContent.innerHTML = '';
        }

        // Connection status
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');

        function updateConnectionStatus(connected) {
            if (connected) {
                statusDot.classList.add('connected');
                statusText.textContent = 'Connected';
            } else {
                statusDot.classList.remove('connected');
                statusText.textContent = 'Disconnected';
            }
        }

        // Check connection status (this would need to be integrated with MQTT handler)
        setTimeout(() => {
            updateConnectionStatus(true); // Assume connected for now
        }, 2000);

        // Auto refresh functionality
        let refreshIntervalId = null;

        function startAutoRefresh(intervalSeconds) {
            if (refreshIntervalId) {
                clearInterval(refreshIntervalId);
            }
            if (intervalSeconds > 0) {
                refreshIntervalId = setInterval(() => {
                    console.log(`Auto-refreshing canvas (${intervalSeconds}s interval)`);
                    getPixels();
                }, intervalSeconds * 1000);
                console.log(`Auto-refresh enabled: ${intervalSeconds}s`);
            } else {
                console.log('Auto-refresh disabled');
            }
        }

        function stopAutoRefresh() {
            if (refreshIntervalId) {
                clearInterval(refreshIntervalId);
                refreshIntervalId = null;
                console.log('Auto-refresh stopped');
            }
        }

        // Refresh interval dropdown handler
        document.getElementById('refresh-interval').addEventListener('change', function() {
            const intervalSeconds = parseInt(this.value);
            localStorage.setItem('refresh-interval', intervalSeconds);
            startAutoRefresh(intervalSeconds);
        });

        // Manual refresh icon handler
        document.getElementById('manual-refresh').addEventListener('click', function() {
            console.log('Manual refresh triggered');
            getPixels();
        });

        // Dark mode functionality
        document.getElementById('dark-mode').addEventListener('change', function() {
            if (this.checked) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
            }
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.documentElement.setAttribute('data-theme', 'dark');
            document.getElementById('dark-mode').checked = true;
        }

        // Load saved refresh interval
        const savedRefreshInterval = localStorage.getItem('refresh-interval');
        if (savedRefreshInterval !== null) {
            const refreshSelect = document.getElementById('refresh-interval');
            refreshSelect.value = savedRefreshInterval;
            startAutoRefresh(parseInt(savedRefreshInterval));
        } else {
            // Initialize with default 30s refresh if no saved value
            startAutoRefresh(30);
        }

        // Load saved pixel scale
        const savedPixelScale = localStorage.getItem('pixel-scale');
        if (savedPixelScale !== null) {
            const pixelScaleSlider = document.getElementById('pixel-scale');
            const pixelScaleValue = document.getElementById('pixel-scale-value');
            pixelScaleSlider.value = savedPixelScale;
            pixelScaleValue.textContent = savedPixelScale;
        }

        // Color picker functionality
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        function rgbToHex(r, g, b) {
            return "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        }

        function updateRgbFromColorPicker(colorPickerId, rId, gId, bId) {
            const colorPicker = document.getElementById(colorPickerId);
            const rInput = document.getElementById(rId);
            const gInput = document.getElementById(gId);
            const bInput = document.getElementById(bId);

            colorPicker.addEventListener('input', function() {
                const rgb = hexToRgb(this.value);
                if (rgb) {
                    rInput.value = rgb.r;
                    gInput.value = rgb.g;
                    bInput.value = rgb.b;
                }
            });
        }

        function updateColorPickerFromRgb(colorPickerId, rId, gId, bId) {
            const colorPicker = document.getElementById(colorPickerId);
            const rInput = document.getElementById(rId);
            const gInput = document.getElementById(gId);
            const bInput = document.getElementById(bId);

            const updateColorPicker = function() {
                const r = parseInt(rInput.value) || 0;
                const g = parseInt(gInput.value) || 0;
                const b = parseInt(bInput.value) || 0;
                colorPicker.value = rgbToHex(r, g, b);
            };

            rInput.addEventListener('input', updateColorPicker);
            gInput.addEventListener('input', updateColorPicker);
            bInput.addEventListener('input', updateColorPicker);
        }

        // Auto template toggle handler
        document.getElementById('auto-arg').addEventListener('change', function() {
            sendAutoTemplate(this.checked ? 'true' : 'false');
        });

        // Initialize color picker functionality
        updateRgbFromColorPicker('bg-color-picker', 'bg-r', 'bg-g', 'bg-b');
        updateRgbFromColorPicker('fg-color-picker', 'fg-r', 'fg-g', 'fg-b');
        updateColorPickerFromRgb('bg-color-picker', 'bg-r', 'bg-g', 'bg-b');
        updateColorPickerFromRgb('fg-color-picker', 'fg-r', 'fg-g', 'fg-b');
    </script>
</body>
</html>
